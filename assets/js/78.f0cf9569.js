(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{454:function(t,e,n){"use strict";n.r(e);var s=n(51),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"setting-up-an-ontop-sparql-endpoint-with-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-an-ontop-sparql-endpoint-with-docker"}},[t._v("#")]),t._v(" Setting up an Ontop SPARQL endpoint with Docker")]),t._v(" "),n("h2",{attrs:{id:"how-to-use-this-image"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-to-use-this-image"}},[t._v("#")]),t._v(" How to use this image")]),t._v(" "),n("p",[t._v("The Docker image "),n("a",{attrs:{href:"https://hub.docker.com/r/ontop/ontop",target:"_blank",rel:"noopener"}},[t._v("ontop/ontop"),n("OutboundLink")],1),t._v(" is for fast setting up an Ontop SPARQL endpoint.\nOne can either use this image directly, or create a dedicated image based on this image.")]),t._v(" "),n("ol",[n("li",[t._v("Go to the "),n("code",[t._v("endpoint/")]),t._v(" directory. Alternatively, if you don't have already the tutorial files, you can download "),n("a",{attrs:{href:"input/university-complete.ttl"}},[t._v("this OWL ontology file")]),t._v(", "),n("a",{attrs:{href:"input/university-complete.obda"}},[t._v("this mapping file")]),t._v(", "),n("a",{attrs:{href:"input/university-complete.properties"}},[t._v("this properties file")]),t._v(" and paste them in "),n("code",[t._v("input/")]),t._v(".")]),t._v(" "),n("li",[t._v("Make sure to have the "),n("code",[t._v("jdbc/")]),t._v(" directory and the JDBC driver inside.")])]),t._v(" "),n("p",[t._v("In addition, we need the "),n("a",{attrs:{href:"../h2.zip"}},[t._v("h2 database")]),t._v(" as usual. Assume the h2 database is already running.")]),t._v(" "),n("p",[n("strong",[t._v("NB")]),t._v(": Linux users have to modify the property "),n("code",[t._v("jdbc.url")]),t._v(" in "),n("a",{attrs:{href:"input/university-complete.docker.properties"}},[n("code",[t._v("input/university-complete.docker.properties")])]),t._v(". Replace "),n("code",[t._v("host.docker.internal")]),t._v(" with the IP address of your machine (you can see it running the "),n("code",[t._v("ifconfig")]),t._v(" command).")]),t._v(" "),n("h3",{attrs:{id:"use-ontop-ontop-directly"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#use-ontop-ontop-directly"}},[t._v("#")]),t._v(" Use "),n("code",[t._v("ontop/ontop")]),t._v(" directly")]),t._v(" "),n("p",[t._v("We can start an Ontop SPARQL endpoint by using the "),n("code",[t._v("ontop/ontop")]),t._v(" image directly.\nOn Linux/Mac:")]),t._v(" "),n("div",{staticClass:"language-console extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("docker run --rm \\\n           -v $PWD/input:/opt/ontop/input \\\n           -v $PWD/jdbc:/opt/ontop/jdbc \\\n           -e ONTOP_ONTOLOGY_FILE=/opt/ontop/input/university-complete.ttl \\\n           -e ONTOP_MAPPING_FILE=/opt/ontop/input/university-complete.obda \\\n           -e ONTOP_PROPERTIES_FILE=/opt/ontop/input/university-complete.docker.properties \\\n           -p 8080:8080 \\\n           ontop/ontop\n")])])]),n("p",[t._v("On Windows:")]),t._v(" "),n("div",{staticClass:"language-console extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("docker run --rm ^\n           -v %CD%/input:/opt/ontop/input ^\n           -v %CD%/jdbc:/opt/ontop/jdbc ^\n           -e ONTOP_ONTOLOGY_FILE=/opt/ontop/input/university-complete.ttl ^\n           -e ONTOP_MAPPING_FILE=/opt/ontop/input/university-complete.obda ^\n           -e ONTOP_PROPERTIES_FILE=/opt/ontop/input/university-complete.docker.properties ^\n           -p 8080:8080 ^\n           ontop/ontop\n")])])]),n("p",[t._v("Now we can open "),n("a",{attrs:{href:"http://localhost:8080/",target:"_blank",rel:"noopener"}},[t._v("http://localhost:8080/"),n("OutboundLink")],1),t._v(" to test SPARQL queries.")]),t._v(" "),n("h3",{attrs:{id:"create-a-dedicated-image"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#create-a-dedicated-image"}},[t._v("#")]),t._v(" Create a dedicated image")]),t._v(" "),n("p",[t._v("In case we want to deploy a self-contained image, we can write a complete "),n("a",{attrs:{href:"Dockerfile"}},[n("code",[t._v("Dockerfile")])]),t._v(":")]),t._v(" "),n("div",{staticClass:"language-dockerfile extra-class"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" ontop/ontop")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /opt/ontop")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" input/university-complete.ttl input/university-complete.obda input/university-complete.docker.properties input/ ")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" jdbc/h2-1.4.196.jar jdbc/")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 8080")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token instruction"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" java -cp ./lib/*:./jdbc/* -Dlogback.configurationFile=file:./log/logback.xml "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        it.unibz.inf.ontop.cli.Ontop endpoint "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        --ontology=input/university-complete.ttl "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        --mapping=input/university-complete.obda "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        --properties=input/university-complete.docker.properties "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        --cors-allowed-origins=http://yasgui.org "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        --lazy # if needed")]),t._v("\n")])])]),n("p",[t._v("Then, run the commands to build and run the Docker image:")]),t._v(" "),n("div",{staticClass:"language-console extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ docker build -t my-ontop-endpoint .\n$ docker run -it --rm --name my-running-ontop-endpoint -p 8080:8080 my-ontop-endpoint\n")])])]),n("h3",{attrs:{id:"use-docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#use-docker-compose"}},[t._v("#")]),t._v(" Use Docker-compose")]),t._v(" "),n("p",[t._v("Docker-compose allows setting up a number of containers together.\nFor example, the following "),n("a",{attrs:{href:"docker-compose.yml"}},[n("code",[t._v("docker-compose.yml")])]),t._v(" file creates a cluster consisting of an H2 database ("),n("code",[t._v("db")]),t._v(") and an Ontop SPARQL endpoint ("),n("code",[t._v("ontop")]),t._v(").")]),t._v(" "),n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.4'")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" openjdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("jdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./h2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/h2\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-cp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/opt/h2/bin/h2-1.4.196.jar"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.h2.tools.Server"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-tcpAllowOthers"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8082:8082"')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9082:9082"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ontop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ontop/ontop\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ONTOP_ONTOLOGY_FILE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/ontop/input/university"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("complete.ttl\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ONTOP_MAPPING_FILE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/ontop/input/university"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("complete.obda\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ONTOP_PROPERTIES_FILE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/ontop/input/university"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("complete.compose.properties\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ONTOP_PORTAL_FILE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /opt/ontop/input/university"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("complete.portal.toml\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ONTOP_CORS_ALLOWED_ORIGINS")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ONTOP_DEV_MODE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ONTOP_LAZY_INIT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./input"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/ontop/input\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./jdbc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/opt/ontop/jdbc\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080:8080"')]),t._v("\n")])])]),n("p",[t._v("Now we can simply start it:")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("$ docker-compose up\n")])])]),n("p",[t._v("It exposes the following two ports for the browser:")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://localhost:8082",target:"_blank",rel:"noopener"}},[t._v("http://localhost:8082"),n("OutboundLink")],1),t._v(" H2 Web Console")]),t._v(" "),n("li",[n("a",{attrs:{href:"http://localhost:8080",target:"_blank",rel:"noopener"}},[t._v("http://localhost:8080"),n("OutboundLink")],1),t._v(" Ontop SPARQL endpoint")])])])}),[],!1,null,null,null);e.default=a.exports}}]);