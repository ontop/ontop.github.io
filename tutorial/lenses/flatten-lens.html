<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Flatten Lens | Ontop</title>
    <meta name="generator" content="VuePress 1.8.2">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.2b9f24ec.css" as="style"><link rel="preload" href="/assets/js/app.a31ff7dd.js" as="script"><link rel="preload" href="/assets/js/2.ce8d9015.js" as="script"><link rel="preload" href="/assets/js/90.59f81587.js" as="script"><link rel="prefetch" href="/assets/js/10.f185cea6.js"><link rel="prefetch" href="/assets/js/100.88f5d125.js"><link rel="prefetch" href="/assets/js/101.9ab7aec6.js"><link rel="prefetch" href="/assets/js/11.187ca5d7.js"><link rel="prefetch" href="/assets/js/12.d4ba3737.js"><link rel="prefetch" href="/assets/js/13.9330117e.js"><link rel="prefetch" href="/assets/js/14.cabf7cc1.js"><link rel="prefetch" href="/assets/js/15.7caa7cef.js"><link rel="prefetch" href="/assets/js/16.6ea3c048.js"><link rel="prefetch" href="/assets/js/17.23c168f3.js"><link rel="prefetch" href="/assets/js/18.1de16b6c.js"><link rel="prefetch" href="/assets/js/19.c55473af.js"><link rel="prefetch" href="/assets/js/20.8c67cb7d.js"><link rel="prefetch" href="/assets/js/21.ca929ef0.js"><link rel="prefetch" href="/assets/js/22.278cc1b2.js"><link rel="prefetch" href="/assets/js/23.fccfc77c.js"><link rel="prefetch" href="/assets/js/24.e8f61543.js"><link rel="prefetch" href="/assets/js/25.83faf49d.js"><link rel="prefetch" href="/assets/js/26.f2aa70fe.js"><link rel="prefetch" href="/assets/js/27.906526eb.js"><link rel="prefetch" href="/assets/js/28.4cee7768.js"><link rel="prefetch" href="/assets/js/29.6957445c.js"><link rel="prefetch" href="/assets/js/3.b2b12655.js"><link rel="prefetch" href="/assets/js/30.a3858dfb.js"><link rel="prefetch" href="/assets/js/31.de926e6b.js"><link rel="prefetch" href="/assets/js/32.b53a48b5.js"><link rel="prefetch" href="/assets/js/33.99c5563f.js"><link rel="prefetch" href="/assets/js/34.8ccb5745.js"><link rel="prefetch" href="/assets/js/35.0d038968.js"><link rel="prefetch" href="/assets/js/36.2707be78.js"><link rel="prefetch" href="/assets/js/37.fa71704e.js"><link rel="prefetch" href="/assets/js/38.72435b1c.js"><link rel="prefetch" href="/assets/js/39.b0971467.js"><link rel="prefetch" href="/assets/js/4.a66f962f.js"><link rel="prefetch" href="/assets/js/40.407c9de6.js"><link rel="prefetch" href="/assets/js/41.42effb13.js"><link rel="prefetch" href="/assets/js/42.55b70bc6.js"><link rel="prefetch" href="/assets/js/43.2d74ecb3.js"><link rel="prefetch" href="/assets/js/44.e4a1f226.js"><link rel="prefetch" href="/assets/js/45.5278a03f.js"><link rel="prefetch" href="/assets/js/46.ca87f0f8.js"><link rel="prefetch" href="/assets/js/47.1c513a29.js"><link rel="prefetch" href="/assets/js/48.8d54295d.js"><link rel="prefetch" href="/assets/js/49.1e42a7ad.js"><link rel="prefetch" href="/assets/js/5.e8e9de00.js"><link rel="prefetch" href="/assets/js/50.97e13341.js"><link rel="prefetch" href="/assets/js/51.774761ee.js"><link rel="prefetch" href="/assets/js/52.24b98f0a.js"><link rel="prefetch" href="/assets/js/53.d51541e8.js"><link rel="prefetch" href="/assets/js/54.788faf62.js"><link rel="prefetch" href="/assets/js/55.6822d82c.js"><link rel="prefetch" href="/assets/js/56.9674465f.js"><link rel="prefetch" href="/assets/js/57.1f98d278.js"><link rel="prefetch" href="/assets/js/58.5a927cba.js"><link rel="prefetch" href="/assets/js/59.01f91d11.js"><link rel="prefetch" href="/assets/js/6.e48edabd.js"><link rel="prefetch" href="/assets/js/60.9f0df2c5.js"><link rel="prefetch" href="/assets/js/61.521e2d39.js"><link rel="prefetch" href="/assets/js/62.6308119b.js"><link rel="prefetch" href="/assets/js/63.134ed7ce.js"><link rel="prefetch" href="/assets/js/64.db505625.js"><link rel="prefetch" href="/assets/js/65.0e7618e9.js"><link rel="prefetch" href="/assets/js/66.a625becd.js"><link rel="prefetch" href="/assets/js/67.9451bb05.js"><link rel="prefetch" href="/assets/js/68.380f49ae.js"><link rel="prefetch" href="/assets/js/69.bd14a16e.js"><link rel="prefetch" href="/assets/js/7.e665b7ff.js"><link rel="prefetch" href="/assets/js/70.500112d2.js"><link rel="prefetch" href="/assets/js/71.1855dfe0.js"><link rel="prefetch" href="/assets/js/72.deb0779e.js"><link rel="prefetch" href="/assets/js/73.7ee3fafd.js"><link rel="prefetch" href="/assets/js/74.c2dd927f.js"><link rel="prefetch" href="/assets/js/75.93c81937.js"><link rel="prefetch" href="/assets/js/76.18a04cfe.js"><link rel="prefetch" href="/assets/js/77.9e873189.js"><link rel="prefetch" href="/assets/js/78.56d3fb51.js"><link rel="prefetch" href="/assets/js/79.2b4ef530.js"><link rel="prefetch" href="/assets/js/8.a24e3ea0.js"><link rel="prefetch" href="/assets/js/80.2ccb5ee6.js"><link rel="prefetch" href="/assets/js/81.49e95fd0.js"><link rel="prefetch" href="/assets/js/82.9b6b3a3a.js"><link rel="prefetch" href="/assets/js/83.9257a559.js"><link rel="prefetch" href="/assets/js/84.a0250eb6.js"><link rel="prefetch" href="/assets/js/85.95b6bb73.js"><link rel="prefetch" href="/assets/js/86.8396d814.js"><link rel="prefetch" href="/assets/js/87.4e3c3b2f.js"><link rel="prefetch" href="/assets/js/88.883aa17a.js"><link rel="prefetch" href="/assets/js/89.d79d29d2.js"><link rel="prefetch" href="/assets/js/9.2397fef4.js"><link rel="prefetch" href="/assets/js/91.544c40d3.js"><link rel="prefetch" href="/assets/js/92.7a52294b.js"><link rel="prefetch" href="/assets/js/93.4ebe793b.js"><link rel="prefetch" href="/assets/js/94.3bfe6f69.js"><link rel="prefetch" href="/assets/js/95.49f8a9b5.js"><link rel="prefetch" href="/assets/js/96.def7d709.js"><link rel="prefetch" href="/assets/js/97.304c61e4.js"><link rel="prefetch" href="/assets/js/98.503ad04a.js"><link rel="prefetch" href="/assets/js/99.ba5b9a3e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2b9f24ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ontop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><a href="/download/" class="nav-link">
  Download
</a></div><div class="nav-item"><a href="/community/" class="nav-link">
  Community
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  Research
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  Dev
</a></div><div class="nav-item"><a href="/jobs/" class="nav-link">
  Work with us
</a></div> <a href="https://github.com/ontop/ontop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><a href="/download/" class="nav-link">
  Download
</a></div><div class="nav-item"><a href="/community/" class="nav-link">
  Community
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  Research
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  Dev
</a></div><div class="nav-item"><a href="/jobs/" class="nav-link">
  Work with us
</a></div> <a href="https://github.com/ontop/ontop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tutorial</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/" aria-current="page" class="sidebar-link">Presentation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Basics</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/basic/setup.html" class="sidebar-link">Database and Ontop Setup</a></li><li><a href="/tutorial/basic/university-1.html" class="sidebar-link">First data source: university 1</a></li><li><a href="/tutorial/basic/university-2.html" class="sidebar-link">Second data source: university 2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Endpoint</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/endpoint/" class="sidebar-link">Deploying a SPARQL endpoint</a></li><li><a href="/tutorial/endpoint/endpoint-cli.html" class="sidebar-link">Setting up an Ontop SPARQL endpoint with Ontop CLI</a></li><li><a href="/tutorial/endpoint/endpoint-docker.html" class="sidebar-link">Setting up an Ontop SPARQL endpoint with Docker</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Interact</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/interact/cli.html" class="sidebar-link">Interact with an Ontop SPARQL Endpoint</a></li><li><a href="/tutorial/interact/jupyter.html" class="sidebar-link">Use Jupyter Notebook with an Ontop SPARQL endpoint</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Mapping</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/mapping/" class="sidebar-link">Second session: Mapping Engineering</a></li><li><a href="/tutorial/mapping/primary-keys.html" class="sidebar-link">Role of primary keys (unique constraints)</a></li><li><a href="/tutorial/mapping/foreign-keys.html" class="sidebar-link">Role of foreign keys</a></li><li><a href="/tutorial/mapping/uri-templates.html" class="sidebar-link">Choice of the IRI templates</a></li><li><a href="/tutorial/mapping/existential.html" class="sidebar-link">Bonus: existential reasoning</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Materialize</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/materialization/materialization.html" class="sidebar-link">How to materialize data into a graph database</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Federation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/federation/" class="sidebar-link">Federating multiple databases</a></li><li><a href="/tutorial/federation/denodo/" class="sidebar-link">Ontop with Denodo</a></li><li><a href="/tutorial/federation/dremio/" class="sidebar-link">Ontop with Dremio</a></li><li><a href="/tutorial/federation/teiid/" class="sidebar-link">Ontop with Teiid</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Lenses</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/lenses/" aria-current="page" class="sidebar-link">Using lenses</a></li><li><a href="/tutorial/lenses/setup.html" class="sidebar-link">Database and Ontop Setup</a></li><li><a href="/tutorial/lenses/basic-lens.html" class="sidebar-link">Basic Lens</a></li><li><a href="/tutorial/lenses/join-lens.html" class="sidebar-link">Join Lens</a></li><li><a href="/tutorial/lenses/union-lens.html" class="sidebar-link">Union Lens</a></li><li><a href="/tutorial/lenses/flatten-lens.html" aria-current="page" class="active sidebar-link">Flatten Lens</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/tutorial/lenses/sql-lens.html" class="sidebar-link">SQL Lens</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/external-tutorials.html" class="sidebar-link">External tutorials</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="flatten-lens"><a href="#flatten-lens" class="header-anchor">#</a> Flatten Lens</h1> <p><em>Flatten lenses are supported since 5.1.0.</em></p> <p>Flattening or unnesting an array is the process of transforming a nested array into an array of lower dimensionality, by &quot;pulling&quot; each nested entry into its &quot;outer&quot; entry. In databases, specifically, it represents a function that takes a column containing an array and transforms it into a table that has each of the <em>outer-most</em> elements as one of its rows.</p> <p>Flattening is need when we want to map values inside arrays.</p> <p>In Ontop, a flatten lens is a type of lens over a single base relation that takes as an input the column that should be flattened, the names of columns that should be retained after flattening, and the name of the column that should be added containing the flattened output. Additionally, the name for a <em>position</em> column can be passed to the lens. When flattening, the <em>position</em> column will hold the index of the current row's flattened element in the original array.</p> <p>For this example, we will first look at the table <code>workers</code>. This table has the following schema:</p> <table><thead><tr><th>column</th> <th>type</th></tr></thead> <tbody><tr><td>worker_id</td> <td>integer</td></tr> <tr><td>full_name</td> <td>string</td></tr> <tr><td>role</td> <td>string</td></tr> <tr><td>museum_id</td> <td>integer</td></tr> <tr><td>titles</td> <td>array of strings</td></tr> <tr><td>access_level</td> <td>integer</td></tr></tbody></table> <p>The column <code>titles</code> is an array of strings that contains all the degrees and titles the employee has received. Our goal is to populate the datatype properties <code>:hasTitle</code> defined from the <code>:Worker</code> class to any number of string literals taken from the table, and <code>:preferredTitle</code>, defined from the <code>:Worker</code> class to a single literal, which is the first entry of the <code>titles</code> array. To do so efficiently, we need to flatten the <code>titles</code> column.</p> <p>The flatten lens has the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span>
    <span class="token property">&quot;flattenedColumn&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token property">&quot;datatype&quot;</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;kept&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;new&quot;</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token property">&quot;position&quot;</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FlattenLens&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The field <code>kept</code> takes a list of column names from the original table that should be retained after flattening. The field <code>new</code> takes the name of the column that contains the flattened output and the field <code>position</code> takes the name of the column that contains the index of the current output. The flattened column takes two arguments: <code>name</code> determines the name of the column that should be flattened, and <code>datatype</code> indicates the column's type. Depending on the SQL dialect, this can vary from <code>ARRAY&lt;T&gt;</code> or <code>T[]</code> where <code>T</code> is a different SQL data type to <code>JSON</code> or <code>VARCHAR</code> if arrays are represented and flattened in JSON format.</p> <p>In DuckDB, the array data type is defined as <code>T[]</code>, so in our specific case, the field <code>datatype</code> will take the value <code>STRING[]</code>.</p> <p>A possible <code>lenses.json</code> file for this task may look like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;flattened_titles&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;workers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;flattenedColumn&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;titles&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;datatype&quot;</span><span class="token operator">:</span> <span class="token string">&quot;STRING[]&quot;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;kept&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;worker_id&quot;</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;new&quot;</span><span class="token operator">:</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span>
                <span class="token property">&quot;position&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As we just need to assign a title to a <code>:Worker</code> individual, the only column that has to be kept is <code>worker_id</code>.</p> <h3 id="mapping"><a href="#mapping" class="header-anchor">#</a> Mapping</h3> <p>Now, we can already define the mapping entries for the wanted properties:</p> <div class="language-obda extra-class"><pre class="language-text"><code>mappingId	MAPID-has-title
target		data:worker/{worker_id} :hasTitle {title} .
source		SELECT worker_id, title FROM lenses.flattened_titles;
mappingId	MAPID-preferred-title
target		data:worker/{worker_id} :preferredTitle {title} .
source		SELECT worker_id, title FROM lenses.flattened_titles WHERE index = 1;
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Instead of using a source query with a <code>WHERE</code> condition in the second mapping, we could also wrap a basic lens around the flatten lens that performs the filter operation, but we kept it like this for the sake of simplicity.</p></div> <p>Let us now run a SPARQL query over the Ontop endpoint to test our mappings and lenses.</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code><span class="token keyword">PREFIX</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token url"><span class="token punctuation">&lt;</span>http://example.org/museum_kg/<span class="token punctuation">&gt;</span></span>
<span class="token keyword">SELECT</span> <span class="token variable">?name</span> <span class="token variable">?title</span> <span class="token variable">?prefTitle</span> <span class="token keyword">WHERE</span> <span class="token punctuation">{</span>
    <span class="token variable">?worker</span> <span class="token keyword">a</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">Worker</span></span> <span class="token punctuation">.</span>
    <span class="token variable">?worker</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">name</span></span> <span class="token variable">?name</span> <span class="token punctuation">.</span>
    <span class="token variable">?worker</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">hasTitle</span></span> <span class="token variable">?title</span> <span class="token punctuation">.</span>
    <span class="token variable">?worker</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">preferredTitle</span></span> <span class="token variable">?prefTitle</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This should result in a list of all employees, together with their titles and their preferred title.</p> <h3 id="flattening-other-types-of-arrays"><a href="#flattening-other-types-of-arrays" class="header-anchor">#</a> Flattening other types of arrays</h3> <p>The flatten lens works on all types of arrays, and, depending on the capabilities of the dialect, can infer the output type of the flattened column. As a further exercise, try looking at the table <code>museums</code>.</p> <table><thead><tr><th>column</th> <th>type</th></tr></thead> <tbody><tr><td>museum_id</td> <td>integer</td></tr> <tr><td>name</td> <td>string</td></tr> <tr><td>address</td> <td>string</td></tr> <tr><td>yearly_income</td> <td>integer</td></tr> <tr><td>yearly_spendings</td> <td>integer</td></tr> <tr><td>ratings</td> <td>array of floats</td></tr></tbody></table> <p>The field <code>ratings</code> is an array of floating point numbers between 1 and 10. Try creating a flatten lens that can unnest this array to populate the datatype property <code>:hasRating</code>! Ontop will be able to automatically detect that the flattened column has the type <code>FLOAT</code>. Keep in mind that we do not necessarily need a &quot;position&quot; column for this use case.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>When arrays in a given dialect are defined as <code>ARRAY&lt;T&gt;</code>, <code>T[]</code>, or similarly, Ontop is able to infer the data type of the output column after flattening. However, when this is not the case (either the array was provided as JSON or the array data type of the dialect is simply called <code>ARRAY</code> or similarly), Ontop cannot perform this inference. In those cases, it is suggested to put a basic lens over the flatten lens that explicitly performs a <code>CAST</code> on the output, to allow Ontop to know the column type once again.</p></div> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The level of support for the flatten lens depends strongly on the dialect. Please consult the <a href="/guide/advanced/lenses.html">flatten lens documentation page</a> for more info on each supported dialect.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ontop/ontop-website/edit/master/tutorial/lenses/flatten-lens.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/19/2025, 5:02:12 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tutorial/lenses/union-lens.html" class="prev">
        Union Lens
      </a></span> <span class="next"><a href="/tutorial/lenses/sql-lens.html">
        SQL Lens
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a31ff7dd.js" defer></script><script src="/assets/js/2.ce8d9015.js" defer></script><script src="/assets/js/90.59f81587.js" defer></script>
  </body>
</html>
