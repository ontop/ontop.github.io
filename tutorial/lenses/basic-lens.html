<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basic Lens | Ontop</title>
    <meta name="generator" content="VuePress 1.8.2">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.2b9f24ec.css" as="style"><link rel="preload" href="/assets/js/app.dd105c0f.js" as="script"><link rel="preload" href="/assets/js/2.ce8d9015.js" as="script"><link rel="preload" href="/assets/js/87.69e9cfa7.js" as="script"><link rel="prefetch" href="/assets/js/10.2e10abfc.js"><link rel="prefetch" href="/assets/js/11.9c479812.js"><link rel="prefetch" href="/assets/js/12.5ae33baf.js"><link rel="prefetch" href="/assets/js/13.9330117e.js"><link rel="prefetch" href="/assets/js/14.cabf7cc1.js"><link rel="prefetch" href="/assets/js/15.8ec0d624.js"><link rel="prefetch" href="/assets/js/16.6ea3c048.js"><link rel="prefetch" href="/assets/js/17.23c168f3.js"><link rel="prefetch" href="/assets/js/18.1de16b6c.js"><link rel="prefetch" href="/assets/js/19.c55473af.js"><link rel="prefetch" href="/assets/js/20.8c67cb7d.js"><link rel="prefetch" href="/assets/js/21.101f0364.js"><link rel="prefetch" href="/assets/js/22.c12075f0.js"><link rel="prefetch" href="/assets/js/23.43b5e0ca.js"><link rel="prefetch" href="/assets/js/24.e8f61543.js"><link rel="prefetch" href="/assets/js/25.2396cff3.js"><link rel="prefetch" href="/assets/js/26.d98cd04f.js"><link rel="prefetch" href="/assets/js/27.906526eb.js"><link rel="prefetch" href="/assets/js/28.94f3980e.js"><link rel="prefetch" href="/assets/js/29.6957445c.js"><link rel="prefetch" href="/assets/js/3.4c4f4577.js"><link rel="prefetch" href="/assets/js/30.a3858dfb.js"><link rel="prefetch" href="/assets/js/31.e0f4dd4b.js"><link rel="prefetch" href="/assets/js/32.bbc94ac1.js"><link rel="prefetch" href="/assets/js/33.45b3ef2c.js"><link rel="prefetch" href="/assets/js/34.5c6a9e4c.js"><link rel="prefetch" href="/assets/js/35.0d111cf6.js"><link rel="prefetch" href="/assets/js/36.c44deccc.js"><link rel="prefetch" href="/assets/js/37.6107b099.js"><link rel="prefetch" href="/assets/js/38.87dd8c58.js"><link rel="prefetch" href="/assets/js/39.4ef07159.js"><link rel="prefetch" href="/assets/js/4.65c6f7cd.js"><link rel="prefetch" href="/assets/js/40.8365f4c5.js"><link rel="prefetch" href="/assets/js/41.ae6d507e.js"><link rel="prefetch" href="/assets/js/42.e1a28f0e.js"><link rel="prefetch" href="/assets/js/43.a55fd68b.js"><link rel="prefetch" href="/assets/js/44.e2d6c57b.js"><link rel="prefetch" href="/assets/js/45.2ccb4f34.js"><link rel="prefetch" href="/assets/js/46.89c14fd5.js"><link rel="prefetch" href="/assets/js/47.98d2cf2a.js"><link rel="prefetch" href="/assets/js/48.922103e8.js"><link rel="prefetch" href="/assets/js/49.dfdb56c2.js"><link rel="prefetch" href="/assets/js/5.e8e9de00.js"><link rel="prefetch" href="/assets/js/50.c0ac6e0e.js"><link rel="prefetch" href="/assets/js/51.1d96f6b2.js"><link rel="prefetch" href="/assets/js/52.f706f4c4.js"><link rel="prefetch" href="/assets/js/53.09cbf035.js"><link rel="prefetch" href="/assets/js/54.a3d413c8.js"><link rel="prefetch" href="/assets/js/55.f961f261.js"><link rel="prefetch" href="/assets/js/56.7df4d26d.js"><link rel="prefetch" href="/assets/js/57.875eb1b7.js"><link rel="prefetch" href="/assets/js/58.84614c17.js"><link rel="prefetch" href="/assets/js/59.8a99da0a.js"><link rel="prefetch" href="/assets/js/6.e48edabd.js"><link rel="prefetch" href="/assets/js/60.afe27b10.js"><link rel="prefetch" href="/assets/js/61.c3d9a46e.js"><link rel="prefetch" href="/assets/js/62.bc19bdad.js"><link rel="prefetch" href="/assets/js/63.3958e67e.js"><link rel="prefetch" href="/assets/js/64.346036f0.js"><link rel="prefetch" href="/assets/js/65.b3b941a0.js"><link rel="prefetch" href="/assets/js/66.c44124a7.js"><link rel="prefetch" href="/assets/js/67.64e2a825.js"><link rel="prefetch" href="/assets/js/68.e10a3527.js"><link rel="prefetch" href="/assets/js/69.6d63de0c.js"><link rel="prefetch" href="/assets/js/7.95d781a2.js"><link rel="prefetch" href="/assets/js/70.b9f43dfa.js"><link rel="prefetch" href="/assets/js/71.0cfd9227.js"><link rel="prefetch" href="/assets/js/72.6b1462d3.js"><link rel="prefetch" href="/assets/js/73.fb51a3b3.js"><link rel="prefetch" href="/assets/js/74.844910a1.js"><link rel="prefetch" href="/assets/js/75.b3759ae1.js"><link rel="prefetch" href="/assets/js/76.a37b539d.js"><link rel="prefetch" href="/assets/js/77.c19a7ca8.js"><link rel="prefetch" href="/assets/js/78.70341003.js"><link rel="prefetch" href="/assets/js/79.3b685102.js"><link rel="prefetch" href="/assets/js/8.a24e3ea0.js"><link rel="prefetch" href="/assets/js/80.64f8b67b.js"><link rel="prefetch" href="/assets/js/81.e950ffd8.js"><link rel="prefetch" href="/assets/js/82.58d62800.js"><link rel="prefetch" href="/assets/js/83.f05ae714.js"><link rel="prefetch" href="/assets/js/84.0fe69a4f.js"><link rel="prefetch" href="/assets/js/85.2663cb75.js"><link rel="prefetch" href="/assets/js/86.e4a298ad.js"><link rel="prefetch" href="/assets/js/88.d06c7d2f.js"><link rel="prefetch" href="/assets/js/89.089b6b8c.js"><link rel="prefetch" href="/assets/js/9.2397fef4.js"><link rel="prefetch" href="/assets/js/90.2da9f11c.js"><link rel="prefetch" href="/assets/js/91.07b1c0b4.js"><link rel="prefetch" href="/assets/js/92.2f52313f.js"><link rel="prefetch" href="/assets/js/93.b5c01828.js"><link rel="prefetch" href="/assets/js/94.e4685204.js"><link rel="prefetch" href="/assets/js/95.6f84c28c.js"><link rel="prefetch" href="/assets/js/96.b79f0927.js"><link rel="prefetch" href="/assets/js/97.dc3e9026.js"><link rel="prefetch" href="/assets/js/98.92948a43.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2b9f24ec.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ontop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><a href="/download/" class="nav-link">
  Download
</a></div><div class="nav-item"><a href="/community/" class="nav-link">
  Community
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  Research
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  Dev
</a></div><div class="nav-item"><a href="/jobs/" class="nav-link">
  Work with us
</a></div> <a href="https://github.com/ontop/ontop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/tutorial/" class="nav-link router-link-active">
  Tutorial
</a></div><div class="nav-item"><a href="/download/" class="nav-link">
  Download
</a></div><div class="nav-item"><a href="/community/" class="nav-link">
  Community
</a></div><div class="nav-item"><a href="/research/" class="nav-link">
  Research
</a></div><div class="nav-item"><a href="/dev/" class="nav-link">
  Dev
</a></div><div class="nav-item"><a href="/jobs/" class="nav-link">
  Work with us
</a></div> <a href="https://github.com/ontop/ontop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Tutorial</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/" aria-current="page" class="sidebar-link">Presentation</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Basics</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/basic/setup.html" class="sidebar-link">Database and Ontop Setup</a></li><li><a href="/tutorial/basic/university-1.html" class="sidebar-link">First data source: university 1</a></li><li><a href="/tutorial/basic/university-2.html" class="sidebar-link">Second data source: university 2</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Endpoint</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/endpoint/" class="sidebar-link">Deploying a SPARQL endpoint</a></li><li><a href="/tutorial/endpoint/endpoint-cli.html" class="sidebar-link">Setting up an Ontop SPARQL endpoint with Ontop CLI</a></li><li><a href="/tutorial/endpoint/endpoint-docker.html" class="sidebar-link">Setting up an Ontop SPARQL endpoint with Docker</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Interact</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/interact/cli.html" class="sidebar-link">Interact with an Ontop SPARQL Endpoint</a></li><li><a href="/tutorial/interact/jupyter.html" class="sidebar-link">Use Jupyter Notebook with an Ontop SPARQL endpoint</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Mapping</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/mapping/" class="sidebar-link">Second session: Mapping Engineering</a></li><li><a href="/tutorial/mapping/primary-keys.html" class="sidebar-link">Role of primary keys (unique constraints)</a></li><li><a href="/tutorial/mapping/foreign-keys.html" class="sidebar-link">Role of foreign keys</a></li><li><a href="/tutorial/mapping/uri-templates.html" class="sidebar-link">Choice of the IRI templates</a></li><li><a href="/tutorial/mapping/existential.html" class="sidebar-link">Bonus: existential reasoning</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Federation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/federation/" class="sidebar-link">Federating multiple databases</a></li><li><a href="/tutorial/federation/denodo/" class="sidebar-link">Ontop with Denodo</a></li><li><a href="/tutorial/federation/dremio/" class="sidebar-link">Ontop with Dremio</a></li><li><a href="/tutorial/federation/teiid/" class="sidebar-link">Ontop with Teiid</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Lenses</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/lenses/" aria-current="page" class="sidebar-link">Using Ontop Lenses</a></li><li><a href="/tutorial/lenses/setup.html" class="sidebar-link">Database and Ontop Setup</a></li><li><a href="/tutorial/lenses/basic-lens.html" aria-current="page" class="active sidebar-link">Basic Lens</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tutorial/lenses/basic-lens.html#projection" class="sidebar-link">Projection</a></li><li class="sidebar-sub-header"><a href="/tutorial/lenses/basic-lens.html#filter" class="sidebar-link">Filter</a></li><li class="sidebar-sub-header"><a href="/tutorial/lenses/basic-lens.html#adding-constraints" class="sidebar-link">Adding Constraints</a></li></ul></li><li><a href="/tutorial/lenses/join-lens.html" class="sidebar-link">Join Lens</a></li><li><a href="/tutorial/lenses/union-lens.html" class="sidebar-link">Union Lens</a></li><li><a href="/tutorial/lenses/flatten-lens.html" class="sidebar-link">Flatten Lens</a></li><li><a href="/tutorial/lenses/sql-lens.html" class="sidebar-link">SQL Lens</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Others</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tutorial/external-tutorials.html" class="sidebar-link">External tutorials</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="basic-lens"><a href="#basic-lens" class="header-anchor">#</a> Basic Lens</h1> <p>Basic lenses can be used on one base relation, over which we can apply a filter, an extended projection, and additional constraints.</p> <h2 id="projection"><a href="#projection" class="header-anchor">#</a> Projection</h2> <p>For this section, we first look at the table <code>museums</code> from the DuckDB database. This table has the following schema:</p> <table><thead><tr><th>column</th> <th>type</th></tr></thead> <tbody><tr><td>museum_id</td> <td>integer</td></tr> <tr><td>name</td> <td>string</td></tr> <tr><td>address</td> <td>string</td></tr> <tr><td>yearly_income</td> <td>integer</td></tr> <tr><td>yearly_spendings</td> <td>integer</td></tr> <tr><td>ratings</td> <td>array of floats</td></tr></tbody></table> <p>The column <code>museum_id</code> is a primary key.</p> <p>Now, we make two decisions:</p> <ol><li>The <code>ratings</code> column is not important to us, so we want to remove it.</li> <li>The columns <code>yearly_income</code> and <code>yearly_spendings</code> are not interesting, but we would like to know the yearly profit (<em>income - spendings</em>)</li></ol> <p>Both of these goals can be achieved using a single basic lens. The basic lens has the following structure:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
            <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> String
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;hidden&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;filterExpression&quot;</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can prepare our <code>lenses.json</code> file like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;museum_projection&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;museums&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span> 
                <span class="token property">&quot;hidden&quot;</span><span class="token operator">:</span> ...
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As we do not require a filter, we do not need the field <code>filterExpression</code>.
The field <code>columns</code> can be used to list existing columns that should be removed and new columns that should be added.</p> <p>Above, we decided that the fields <code>ratings</code>, <code>yearly_income</code> and <code>yearly_spendings</code> are not interesting to us. We can easily hide them by including their names in the <code>hidden</code> list.</p> <p>To add a new <code>yearly_profit</code> field, we have to add one entry to the <code>added</code> list, using <code>yearly profit</code> as its name, and using the expression <code>yearly_income - yearly_spendings</code> in its <code>expression</code> field.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Even though we have decided to hide the columns <code>yearly_income</code> and <code>yearly_spendings</code>, we can still use them for expressions within the same lens.</p></div> <p>After making these changes, the full <code>lenses.json</code> file should look like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;museum_projection&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;museums&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yearly_profit&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;expression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CAST(yearly_income - yearly_spendings as INTEGER)&quot;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">&quot;hidden&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ratings&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yearly_income&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;yearly_spendings&quot;</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>In the expression for <code>yearly_profit</code>, we cast the result of the subtraction to an <code>INTEGER</code>. This way, Ontop is guaranteed to know that the column will be of type <code>INTEGER</code>.</p></div> <h3 id="mapping"><a href="#mapping" class="header-anchor">#</a> Mapping</h3> <p>Now that we have created a basic lens to re-format the input table, we can use the lens in a mapping. For this, we start with the mapping template provided in the tutorial files. This template already contains basic mappings that define individuals of the classes <code>:Museum</code> and <code>:Worker</code>.</p> <p>We now want to set the <code>:yearlyProfit</code> datatype property for all museums. We can achieve that by adding the following mapping:</p> <div class="language-obda extra-class"><pre class="language-text"><code>mappingId	MAPID-museum-profit
target		data:museum/{museum_id} :yearlyProfit {yearly_profit} .
source		SELECT museum_id, yearly_profit FROM lenses.museum_projection;
</code></pre></div><p>After doing that, we can copy the <code>lenses.json</code> and <code>mapping.obda</code> files into the Ontop endpoint <code>input</code> directory, as described in the <a href="/tutorial/lenses/setup.html">setup page</a> and start the endpoint. Once the endpoint is started, we can open the SPARQL query editor at <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and run the following query to test it:</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code><span class="token keyword">PREFIX</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token url"><span class="token punctuation">&lt;</span>http://example.org/museum_kg/<span class="token punctuation">&gt;</span></span>
<span class="token keyword">SELECT</span> <span class="token variable">?name</span> <span class="token variable">?profit</span> <span class="token keyword">WHERE</span> <span class="token punctuation">{</span>
    <span class="token variable">?museum</span> <span class="token keyword">a</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">Museum</span></span> <span class="token punctuation">.</span>
    <span class="token variable">?museum</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">name</span></span> <span class="token variable">?name</span> <span class="token punctuation">.</span>
    <span class="token variable">?museum</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">yearlyProfit</span></span> <span class="token variable">?profit</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>If the lenses and mappings were constructed correctly, this query should return a list of museum names, together with different values for their yearly profit.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Notice how by changing the source query by adding <code>ratings</code>, <code>yearly_income</code>, or <code>yearly_spendings</code> to it, the execution of the mapping fails, stating that the columns were not found. This is because they were hidden by the lens.</p></div> <h2 id="filter"><a href="#filter" class="header-anchor">#</a> Filter</h2> <p>Another use case of basic lenses is to filter out some specific rows from the input table. As an example, we will look at the table <code>workers</code>. This table has the following schema:</p> <table><thead><tr><th>column</th> <th>type</th></tr></thead> <tbody><tr><td>worker_id</td> <td>integer</td></tr> <tr><td>full_name</td> <td>string</td></tr> <tr><td>role</td> <td>string</td></tr> <tr><td>museum_id</td> <td>integer</td></tr> <tr><td>titles</td> <td>array of strings</td></tr> <tr><td>access_level</td> <td>integer</td></tr></tbody></table> <p>The column <code>worker_id</code> is a primary key. The column <code>museum_id</code> is a foreign key that references the table <code>museums</code>.</p> <p>The column <code>role</code> is a string that indicates the name of the worker's role. It can take the following three values: <code>&quot;manager&quot;</code>, <code>&quot;guide&quot;</code>, and <code>&quot;guard&quot;</code>. For our VKG, we decide that we want to designate all managers as individuals of the class <code>:Manager</code>. One way to achieve this is to use the filter feature of basic lenses.</p> <p>We can prepare our <code>lenses.json</code> file like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;managers_filter&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;workers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;filterExpression&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>columns</code> field can be removed, as it is not required for this example. Now, we just need to define a value for the field <code>filterExpression</code> that ignores all rows for which the column <code>role</code> is not equal to <code>&quot;manager&quot;</code>. The <code>filterExpression</code> is defined as a SQL expression in the same style as SQL <code>WHERE</code> clauses.</p> <p>After making this change, the full <code>lenses.json</code> file should look like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;managers_filter&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;workers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;filterExpression&quot;</span><span class="token operator">:</span> <span class="token string">&quot;role = 'manager'&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="mapping-2"><a href="#mapping-2" class="header-anchor">#</a> Mapping</h3> <p>We can once again use the generated lens in our mapping file. For this, we will again extend the mapping template with one new mapping:</p> <div class="language-obda extra-class"><pre class="language-text"><code>mappingId	MAPID-worker-managers
target		data:worker/{worker_id} a :Manager .
source		SELECT worker_id FROM lenses.managers_filter;
</code></pre></div><p>Then, we start the Ontop endpoint and open the SPARQL editor to run the following query:</p> <div class="language-SPARQL extra-class"><pre class="language-sparql"><code><span class="token keyword">PREFIX</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span></span> <span class="token url"><span class="token punctuation">&lt;</span>http://example.org/museum_kg/<span class="token punctuation">&gt;</span></span>
<span class="token keyword">SELECT</span> <span class="token variable">?name</span> <span class="token keyword">WHERE</span> <span class="token punctuation">{</span>
    <span class="token variable">?worker</span> <span class="token keyword">a</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">Manager</span></span> <span class="token punctuation">.</span>
    <span class="token variable">?worker</span> <span class="token function"><span class="token prefix"><span class="token punctuation">:</span></span><span class="token local-name">name</span></span> <span class="token variable">?name</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This should result in a list of <em>3</em> manager names.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>All examples in the lens sections are compatible with each other. However, all lenses referenced in the mapping file need to be included in <code>lenses.json</code>. If you wish to continuously extend the mapping file throughout the tutorial,
you will also need to keep all previous lenses in the <code>relations</code> list of the lenses file, otherwise, Ontop will throw an error. Alternatively, you can always start each of the sections from a new mapping template file. This way, only the lenses of the current exercise have to be included.</p></div> <p>As an extension to this exercise, you can now try to define similar lenses and mappings for the <code>&quot;guide&quot;</code> and <code>&quot;guard&quot;</code> roles, assigning them to the classes <code>:Guide</code> and <code>:Guard</code>, respectively.</p> <h2 id="adding-constraints"><a href="#adding-constraints" class="header-anchor">#</a> Adding Constraints</h2> <p>Another valuable feature of lenses is adding further constraints to relations. This feature is supported for <strong>all</strong> types of lenses, but we will cover it in this section only.</p> <p>Generally, Ontop can infer many constraints from the base relation used by a lens. For instance, the field <code>museum_id</code> in the table <code>museumS</code> is a primary key, so it is <em>unique</em> and <em>not null</em>. Our previously defined lens will be able to infer that the output relation is still unique and not null. On the other hand, for composite primary keys, if one part of the composite key is hidden by a lens, then Ontop knows that the remaining part is no longer guaranteed to be unique.</p> <p>In many instances, however, expert knowledge can be used to define further constraints for lenses. A full list of all supported constraints and how they can be defined can be found in the <a href="/guide/advanced/lenses.html">documentation of lenses</a>.</p> <p>For this section, we want to use our expert knowledge of the table <code>workers</code> to provide the following constraints:</p> <ol><li>The name of a worker is <em>unique</em> and <em>not null</em>.</li> <li>The role of a worker is <em>not null</em></li> <li>There is a functional dependency from <em>role</em> to <em>access_level</em>.</li> <li>The column <code>museum_id</code> is a foreign key that references the table <code>museums</code> (DuckDB does not have a notion of foreign keys, so it is useful to add it explicitly).</li> <li>The <code>role</code> column is <em>IRI-safe</em> (all possible values of the column can be safely included in an IRI without further encoding).</li></ol> <p>We can create a basic lens over the table <code>workers</code> to define these constraints, following the guidelines from the <a href="/guide/advanced/lenses.html">documentation of lenses</a>. A possible solution could look like this:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;relations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;lenses&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;workers_constraints&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;baseRelation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;workers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;uniqueConstraints&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;uc&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;determinants&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;full_name&quot;</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;nonNullConstraints&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;full_name&quot;</span><span class="token punctuation">,</span>
                    <span class="token string">&quot;role&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;otherFunctionalDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;determinants&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;dependents&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;access_level&quot;</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;foreignKeys&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;fk&quot;</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;museum_id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token property">&quot;to&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">&quot;relation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;museumS&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                            <span class="token property">&quot;columns&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;museum_id&quot;</span><span class="token punctuation">]</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;iriSafeConstraints&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;added&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">&quot;role&quot;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BasicLens&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Lenses can reference each other!</strong> As a further exercise, you can try using this newly created lens as the <code>baseRelation</code> of the managers filter from before. Once that is done, you can query it again - the results should be the same as before.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>We could also have added all of these constraints to the same <code>managers_filter</code> lens from the previous section to achieve the same results. This has the advantage of reducing the work required for the lens setup and reducing the total number of relations accessible by Ontop, but it is less flexible, as we would have to copy all the constraints to the <code>guides_filter</code> and <code>guard_filter</code> lenses as well, resulting in a lot of duplication.</p> <p>Generally, the optimal solution depends on the specific scenario.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ontop/ontop-website/edit/master/tutorial/lenses/basic-lens.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/18/2023, 10:24:12 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tutorial/lenses/setup.html" class="prev">
        Database and Ontop Setup
      </a></span> <span class="next"><a href="/tutorial/lenses/join-lens.html">
        Join Lens
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dd105c0f.js" defer></script><script src="/assets/js/2.ce8d9015.js" defer></script><script src="/assets/js/87.69e9cfa7.js" defer></script>
  </body>
</html>
